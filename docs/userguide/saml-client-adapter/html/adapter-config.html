<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 2. General Adapter Config</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/><link rel="home" href="index.html" title="Keycloak SAML Client Adapter Reference Guide"/><link rel="up" href="index.html" title="Keycloak SAML Client Adapter Reference Guide"/><link rel="prev" href="ch01.html" title="Chapter 1. Overview"/><link rel="next" href="jboss-adapter.html" title="Chapter 3. JBoss/Wildfly Adapter"/></head><body><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch01.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="jboss-adapter.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="adapter-config"/>Chapter 2. General Adapter Config</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="adapter-config.html#d4e23">2.1. SP Element</a></span></dt><dt><span class="section"><a href="adapter-config.html#sp_keys">2.2. SP Keys and Key elements</a></span></dt><dd><dl><dt><span class="section"><a href="adapter-config.html#keystore">2.2.1. KeyStore element</a></span></dt><dt><span class="section"><a href="adapter-config.html#key_pems">2.2.2. Key PEMS</a></span></dt></dl></dd><dt><span class="section"><a href="adapter-config.html#d4e94">2.3. SP PrincipalNameMapping element</a></span></dt><dt><span class="section"><a href="adapter-config.html#d4e101">2.4. RoleIdentifiers element</a></span></dt><dt><span class="section"><a href="adapter-config.html#d4e109">2.5. IDP Element</a></span></dt><dt><span class="section"><a href="adapter-config.html#d4e136">2.6. IDP SingleSignOnService sub element</a></span></dt><dt><span class="section"><a href="adapter-config.html#d4e170">2.7. IDP SingleSignOnService sub element</a></span></dt><dt><span class="section"><a href="adapter-config.html#d4e221">2.8. IDP Keys subelement</a></span></dt></dl></div>
    
    <p>
        Each SAML adapter supported by Keycloak can be configured by a simple XML text file.  This is what one might
        look like:
    </p>
    <p>
</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;keycloak-saml-adapter&gt;
    &lt;SP entityID="http://localhost:8081/sales-post-sig/"
        sslPolicy="EXTERNAL"
        nameIDPolicyFormat="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"
        logoutPage="/logout.jsp"
        forceAuthentication="false"&gt;
        &lt;Keys&gt;
            &lt;Key signing="true" &gt;
                &lt;KeyStore resource="/WEB-INF/keystore.jks" password="store123"&gt;
                    &lt;PrivateKey alias="http://localhost:8080/sales-post-sig/" password="test123"/&gt;
                    &lt;Certificate alias="http://localhost:8080/sales-post-sig/"/&gt;
                &lt;/KeyStore&gt;
            &lt;/Key&gt;
        &lt;/Keys&gt;
        &lt;PrincipalNameMapping policy="FROM_NAME_ID"/&gt;
        &lt;RoleMapping&gt;
            &lt;Attribute name="Role"/&gt;
        &lt;/RoleMapping&gt;
        &lt;IDP entityID="idp"
             signaturesRequired="true"&gt;
        &lt;SingleSignOnService requestBinding="POST"
                             bindingUrl="http://localhost:8081/auth/realms/demo/protocol/saml"
                    /&gt;

            &lt;SingleLogoutService
                    requestBinding="POST"
                    responseBinding="POST"
                    postBindingUrl="http://localhost:8081/auth/realms/demo/protocol/saml"
                    redirectBindingUrl="http://localhost:8081/auth/realms/demo/protocol/saml"
                    /&gt;
            &lt;Keys&gt;
                &lt;Key signing="true"&gt;
                    &lt;KeyStore resource="/WEB-INF/keystore.jks" password="store123"&gt;
                        &lt;Certificate alias="demo"/&gt;
                    &lt;/KeyStore&gt;
                &lt;/Key&gt;
            &lt;/Keys&gt;
        &lt;/IDP&gt;
     &lt;/SP&gt;
&lt;/keycloak-saml-adapter&gt;

</pre><p>
    </p>
    <p>
        Some of these configuration switches may be adapter specific and some are common across all adapters.
        For Java adapters you can use <code class="literal">${...}</code> enclosure as System property replacement.
        For example <code class="literal">${jboss.server.config.dir}</code>.
    </p>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e23"/>2.1. SP Element</h2></div></div></div>
        
        <p>
            Here is the explanation of the SP element attributes
        </p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;SP entityID="sp"
    sslPolicy="ssl"
    nameIDPolicyFormat="format"
    forceAuthentication="true"&gt;
...
&lt;/SP&gt;</pre>
        <p>
            </p><div class="variablelist"><dl><dt><span class="term">entityID</span></dt><dd>
                        <p>
                            This is the identifier for this client.  The IDP needs this value to determine
                            who the client is that is communicating with it.
                            <span class="emphasis"><em>REQUIRED.</em></span>
                        </p>
                    </dd><dt><span class="term">sslPolicy</span></dt><dd>
                        <p>
                            This is the SSL policy the adapter will enforce.  Valid values are:
                            ALL, EXTERNAL, and NONE.  For ALL, all requests must come in via HTTPS.  For
                            EXTERNAL, only non-private IP addresses must come over the wire via HTTPS.  For
                            NONE, no requests are required to come over via HTTPS.  This is
                            <span class="emphasis"><em>OPTIONAL.</em></span> and defaults to EXTERNAL.
                        </p>
                    </dd><dt><span class="term">nameIDPolicyFormat</span></dt><dd>
                        <p>
                            SAML clients can request a specific NameID Subject format.  Fill in this value
                            if you want a specific format.  It must be a standard SAML format identifier, i.e.
                            <code class="literal">urn:oasis:names:tc:SAML:2.0:nameid-format:transient</code>
                            <span class="emphasis"><em>OPTIONAL.</em></span>.  By default, no special format is requested.
                        </p>
                    </dd><dt><span class="term">forceAuthentication</span></dt><dd>
                        <p>
                            SAML clients can request that a user is re-authenticated even if
                            they are already logged in at the IDP.  Set this to true if you
                            want this.
                            <span class="emphasis"><em>OPTIONAL.</em></span>.  Set to <code class="literal">false</code> by default.
                        </p>
                    </dd></dl></div><p>
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sp_keys"/>2.2. SP Keys and Key elements</h2></div></div></div>
        
        <p>
            If the IDP requires that the SP sign all of its requests and/or if the IDP will
            encrypt assertions, you must define the keys used to do this.  For client signed
            documents you must define both the private and public key or certificate that will
            be used to sign documents.  For encryption, you only have to define the private key
            that will be used to decrypt.
        </p>
        <p>
            There are two ways to describe your keys.  Either they are stored within a Java KeyStore
            or you can cut and paste the keys directly within <code class="literal">keycloak-saml.xml</code>
            in the PEM format.
        </p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
        &lt;Keys&gt;
            &lt;Key signing="true" &gt;
                &lt;KeyStore resource="/WEB-INF/keystore.jks" password="store123"&gt;
                    &lt;PrivateKey alias="http://localhost:8080/sales-post-sig/" password="test123"/&gt;
                    &lt;Certificate alias="http://localhost:8080/sales-post-sig/"/&gt;
                &lt;/KeyStore&gt;
            &lt;/Key&gt;
        &lt;/Keys&gt;

        </pre>
        <p>
            The <code class="literal">Key</code> element has two optional attributes <code class="literal">signing</code>
            and <code class="literal">encryption</code>.  When set to true these tell the adapter what the
            key will be used for.  If both attributes are set to true, then the key will be used for both
            signing documents and decrypting encrypted assertions.  You must set at least one of these
            attributes to true.
        </p>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="keystore"/>2.2.1. KeyStore element</h3></div></div></div>
            
            <p>
                </p><div class="variablelist"><dl><dt><span class="term">file</span></dt><dd>
                            <p>
                                File path to the key store.
                                <span class="emphasis"><em>OPTIONAL.</em></span>  The file or resource attribute
                                must be set.
                            </p>
                        </dd><dt><span class="term">resource</span></dt><dd>
                            <p>
                                WAR resource path to the KeyStore.  This is a path used in method call to ServletContext.getResourceAsStream().
                                <span class="emphasis"><em>OPTIONAL.</em></span>  The file or resource attribute
                                must be set.
                            </p>
                        </dd><dt><span class="term">password</span></dt><dd>
                            <p>
                                The password of the KeyStore
                                <span class="emphasis"><em>REQUIRED.</em></span>
                            </p>
                        </dd></dl></div><p>

            </p>
            <p>
                You can and must also specify references to your private keys and certificates within
                the Java KeyStore.  The <code class="literal">PrivateKey</code> and <code class="literal">Certificate</code>
                elements do this.  The <code class="literal">alias</code> attribute defines the alias within the
                KeyStore for the key.  For <code class="literal">PrivateKey</code>, a password is required to access this key
                specify that value in the <code class="literal">password</code> attribute.
            </p>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="key_pems"/>2.2.2. Key PEMS</h3></div></div></div>
            
            <p>
                Within the <code class="literal">Key</code> element you alternatively declare your keys and certificates
                directly using the sub elements <code class="literal">PrivateKeyPem</code>, <code class="literal">PublicKeyPem</code>, and
                <code class="literal">CertificatePem</code>.  The values contained in these elements must conform to the
                PEM key format.  You usually use this option if you are generating keys using <code class="literal">openssl</code>
            </p>
        </div>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e94"/>2.3. SP PrincipalNameMapping element</h2></div></div></div>
        
        <p>
            This element is optional.  When creating a Java Principal object that you obtain from
            methods like HttpServletRequest.getUserPrincipal(), you can define what name that is returned
            by the Principal.getName() method.  The <code class="literal">policy</code> attribute defines the
            policy used to populate this value.  The values are <code class="literal">FROM_NAME_ID</code>.  This policy
            just grabs whatever the SAML subject value is.  The other is <code class="literal">FROM_ATTRIBUTE</code>.  This will
            pull the value of Principal.getName() from one of the attributes in the SAML assertion received from the server.
            The default value is <code class="literal">FROM_NAME_ID</code>.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e101"/>2.4. RoleIdentifiers element</h2></div></div></div>
        
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;RoleIdentifiers&gt;
     &lt;Attribute name="Role"/&gt;
     &lt;Attribute name="member"/&gt;
     &lt;Attribute name="memberOf"/&gt;
&lt;/RoleIdentifiers&gt;
</pre>
        <p>
            This element is optional.  It defines which SAML attribute values in the assertion should be
            mapped to a Java EE role.  By default <code class="literal">Role</code> attribute values are converted
            to Java EE roles.  Some IDPs send roles via a <code class="literal">member</code> or <code class="literal">memberOf</code>
            attribute assertion.  You define one or more <code class="literal">Attribute</code> elements to specify
            which SAML attributes must be converted into roles.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e109"/>2.5. IDP Element</h2></div></div></div>
        
        <p>
            Everything in the IDP element describes the settings for the IDP the SP is communicating
            with.
        </p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;IDP entityID="idp"
     signaturesRequired="true"
     signatureAlgorithm="RSA_SHA1"
     signatureCanonicalizationMethod="http://www.w3.org/2001/10/xml-exc-c14n#"&gt;
...
&lt;/IDP&gt;
        </pre>
        <p>
            </p><div class="variablelist"><dl><dt><span class="term">entityID</span></dt><dd>
                        <p>
                            This is the issuer ID of the IDP.
                            <span class="emphasis"><em>REQUIRED.</em></span>.
                        </p>
                    </dd><dt><span class="term">signaturesRequired</span></dt><dd>
                        <p>
                            If set to true, the client adapter will sign every document
                            it sends to the IDP.  Also, the client will expect that the IDP
                            will be signing an documents sent to it.  This switch sets
                            the default for all request and response types, but you will see
                            later that you have some fine grain control over this.
                            <span class="emphasis"><em>OPTIONAL.</em></span>
                        </p>
                    </dd><dt><span class="term">signatureAlgorithm</span></dt><dd>
                        <p>
                            This is the signature algorithm that the IDP expects signed documents
                            to use
                            <span class="emphasis"><em>OPTIONAL.</em></span>.  The default value is RSA_SHA256, but
                            you can also use RSA_SHA1, RSA_256, RSA_512, and DSA_SHA1.
                        </p>
                    </dd><dt><span class="term">signatureCanonicalizationMethod</span></dt><dd>
                        <p>
                            This is the signature canonicalization method that the IDP expects signed documents
                            to use
                            <span class="emphasis"><em>OPTIONAL.</em></span>.  The default value is <code class="literal">http://www.w3.org/2001/10/xml-exc-c14n#</code>
                            and should be good for most IDPs.
                        </p>
                    </dd></dl></div><p>
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e136"/>2.6. IDP SingleSignOnService sub element</h2></div></div></div>
        
        <p>
            The <code class="literal">SignleSignOnService</code> sub element defines the
            login SAML endpoint of the IDP.
        </p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;SingleSignOnService signRequest="true"
                     validateResponseSignature="true"
                     requestBinding="post"
                     bindingUrl="url"/&gt;
</pre>
        <p>
            </p><div class="variablelist"><dl><dt><span class="term">signRequest</span></dt><dd>
                        <p>
                            Should the client sign authn requests?
                            <span class="emphasis"><em>OPTIONAL.</em></span>.  Defaults to whatever the
                            IDP <code class="literal">signaturesRequired</code> element value is.
                        </p>
                    </dd><dt><span class="term">validateResponseSignature</span></dt><dd>
                        <p>
                            Should the client expect the IDP to sign the assertion response document
                            sent back from an auhtn request?
                            <span class="emphasis"><em>OPTIONAL.</em></span> Defaults to whatever the
                            IDP <code class="literal">signaturesRequired</code> element value is.
                        </p>
                    </dd><dt><span class="term">requestBinding</span></dt><dd>
                        <p>
                            This is the SAML binding type used for communicating with the IDP
                            <span class="emphasis"><em>OPTIONAL.</em></span>.  The default value is POST, but
                            you can set it to REDIRECT as well.
                        </p>
                    </dd><dt><span class="term">responseBinding</span></dt><dd>
                        <p>
                            SAML allows the client to request what binding type it wants authn responses
                            to use.  The values of this can be POST or REDIRECT
                            <span class="emphasis"><em>OPTIONAL.</em></span>.  The default is that the client will not request
                            a specific binding type for responses.
                        </p>
                    </dd><dt><span class="term">bindingUrl</span></dt><dd>
                        <p>
                            This is the URL for the ID login service that the client will send requests to.
                            <span class="emphasis"><em>REQUIRED.</em></span>.
                        </p>
                    </dd></dl></div><p>
        </p>
    </div>    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e170"/>2.7. IDP SingleSignOnService sub element</h2></div></div></div>
    
    <p>
        The <code class="literal">SignleSignOnService</code> sub element defines the
        login SAML endpoint of the IDP.
    </p>
    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;SingleLogoutService validateRequestSignature="true"
                     validateResponseSignature="true"
                     signRequest="true"
                     signResponse="true"
                     requestBinding="redirect"
                     responseBinding="post"
                     postBindingUrl="posturl"
                     redirectBindingUrl="redirecturl"&gt;
</pre>
    <p>
        </p><div class="variablelist"><dl><dt><span class="term">signRequest</span></dt><dd>
                    <p>
                        Should the client sign logout requests it makes to the IDP?
                        <span class="emphasis"><em>OPTIONAL.</em></span>.  Defaults to whatever the
                        IDP <code class="literal">signaturesRequired</code> element value is.
                    </p>
                </dd><dt><span class="term">signResponse</span></dt><dd>
                    <p>
                        Should the client sign logout responses it sends to the IDP requests?
                        <span class="emphasis"><em>OPTIONAL.</em></span>.  Defaults to whatever the
                        IDP <code class="literal">signaturesRequired</code> element value is.
                    </p>
                </dd><dt><span class="term">validateRequestSignature</span></dt><dd>
                    <p>
                        Should the client expect signed logout request documents from the IDP?
                        <span class="emphasis"><em>OPTIONAL.</em></span> Defaults to whatever the
                        IDP <code class="literal">signaturesRequired</code> element value is.
                    </p>
                </dd><dt><span class="term">validateResponseSignature</span></dt><dd>
                    <p>
                        Should the client expect signed logout response documents from the IDP?
                        <span class="emphasis"><em>OPTIONAL.</em></span> Defaults to whatever the
                        IDP <code class="literal">signaturesRequired</code> element value is.
                    </p>
                </dd><dt><span class="term">requestBinding</span></dt><dd>
                    <p>
                        This is the SAML binding type used for communicating SAML requests to the IDP
                        <span class="emphasis"><em>OPTIONAL.</em></span>.  The default value is POST, but
                        you can set it to REDIRECT as well.
                    </p>
                </dd><dt><span class="term">responseBinding</span></dt><dd>
                    <p>
                        This is the SAML binding type used for communicating SAML responses to the IDP
                        The values of this can be POST or REDIRECT
                        <span class="emphasis"><em>OPTIONAL.</em></span>.  The default value is POST, but
                        you can set it to REDIRECT as well.
                    </p>
                </dd><dt><span class="term">postBindingUrl</span></dt><dd>
                    <p>
                        This is the URL for the IDP's logout service when using the POST binding.
                        <span class="emphasis"><em>REQUIRED</em></span> if using the POST binding at all.
                    </p>
                </dd><dt><span class="term">redirectBindingUrl</span></dt><dd>
                    <p>
                        This is the URL for the IDP's logout service when using the REDIRECT binding.
                        <span class="emphasis"><em>REQUIRED</em></span> if using the REDIRECT binding at all.
                    </p>
                </dd></dl></div><p>
    </p>
</div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e221"/>2.8. IDP Keys subelement</h2></div></div></div>
        
        <p>
            The Keys sub element of IDP is only used to define the certificate or
            public key to use to verify documents signed by the IDP.  It is defined
            in the same way as the <a class="link" href="adapter-config.html#sp_keys" title="2.2. SP Keys and Key elements">SP's Key's element</a>.  But
            again, you only have to define one certificate or public key reference.
        </p>

    </div>

</div><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch01.html"><strong>Prev</strong>Chapter 1. Overview</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="jboss-adapter.html"><strong>Next</strong>Chapter 3. JBoss/Wildfly Adapter</a></li></ul></body></html>